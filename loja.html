<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz Legends - Loja & Invent√°rio</title>
    <style>
        :root {
            --ouro: #c89b3c;
            --ouro-claro: #f0e6d2;
            --fundo: #010a13;
            --card-bg: rgba(9, 20, 40, 0.9);
            --azul-hex: #091428;
            --comum: #808080;
            --raro: #00cfbc;
            --epico: #a335ee;
        }

        body {
            background: radial-gradient(circle at center, #0a323c 0%, #010a13 100%);
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        /* --- HEADER --- */
        .header-principal {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--ouro);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .titulo-hextech {
            margin: 0;
            font-size: 1.5rem;
            letter-spacing: 3px;
            background: linear-gradient(to bottom, var(--ouro-claro), var(--ouro));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
        }

        .caixa-saldo {
            background: var(--azul-hex);
            padding: 8px 15px;
            border: 1px solid var(--ouro);
            color: var(--ouro);
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* --- NAVEGA√á√ÉO --- */
        .abas-navegacao {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .btn-aba {
            background: transparent;
            border: none;
            color: #888;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            cursor: pointer;
            padding: 10px 20px;
            border-bottom: 2px solid transparent;
            transition: 0.3s;
        }

        .btn-aba.ativa {
            color: var(--ouro);
            border-bottom: 2px solid var(--ouro);
        }

        /* --- FILTROS --- */
        .barra-ferramentas {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(1, 10, 19, 0.8);
            padding: 15px 25px;
            border: 1px solid #1e2328;
            margin-bottom: 30px;
        }

        .campo-busca {
            background: #091428;
            border: 1px solid var(--ouro);
            padding: 10px;
            color: white;
            width: 250px;
            outline: none;
        }

        /* --- GRID --- */
        .grid-principal {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 25px;
            max-width: 1100px;
            margin: 0 auto;
        }

        /* --- CARD DE ITEM --- */
        .card-item {
            background: var(--card-bg);
            border: 1px solid #1e2328;
            padding: 20px;
            text-align: center;
            transition: 0.3s;
            clip-path: polygon(10% 0, 90% 0, 100% 10%, 100% 90%, 90% 100%, 10% 100%, 0 90%, 0 10%);
        }

        .card-item:hover { transform: translateY(-5px); border-color: var(--ouro); }

        .preview-imagem {
            width: 90px;
            height: 90px;
            margin: 0 auto 15px;
            display: block;
            border-radius: 4px;
        }

        .nome-item {
            font-weight: 900;
            text-transform: uppercase;
            font-size: 0.85rem;
            margin-bottom: 10px;
            min-height: 40px; /* Garante espa√ßo para 2 linhas */
            line-height: 1.2;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .label-raridade {
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            display: block;
        }

        /* --- BOT√ïES --- */
        .btn-acao {
            background: linear-gradient(to bottom, #c89b3c, #785a28);
            border: 1px solid var(--ouro-claro);
            color: black;
            padding: 12px;
            width: 100%;
            font-weight: bold;
            text-transform: uppercase;
            cursor: pointer;
            clip-path: polygon(15% 0, 85% 0, 100% 50%, 85% 100%, 15% 100%, 0 50%);
        }

        .btn-acao:disabled {
            background: #1e2328;
            border-color: #333;
            color: #555;
            cursor: not-allowed;
        }

        /* --- MODAL --- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-box {
            background: var(--azul-hex);
            border: 2px solid var(--ouro);
            padding: 35px;
            max-width: 400px;
            text-align: center;
            clip-path: polygon(10% 0, 90% 0, 100% 15%, 100% 85%, 90% 100%, 10% 100%, 0 85%, 0 15%);
        }

        .modal-titulo { color: var(--ouro); font-weight: bold; margin-bottom: 10px; font-size: 1.3rem; text-transform: uppercase; }
        .modal-info { color: #ccc; font-size: 0.95rem; margin-bottom: 25px; line-height: 1.5; }

        .btn-confirmar { background: var(--ouro); color: black; border: none; padding: 10px 25px; font-weight: bold; cursor: pointer; margin: 5px; text-transform: uppercase; }
        .btn-cancelar { background: transparent; border: 1px solid var(--ouro); color: var(--ouro); padding: 10px 25px; font-weight: bold; cursor: pointer; margin: 5px; text-transform: uppercase; }

        /* --- CORES DE RARIDADE --- */
        .comum { border-color: var(--comum); }
        .raro { border-color: var(--raro); }
        .epico { border-color: var(--epico); }
        .txt-comum { color: var(--comum); }
        .txt-raro { color: var(--raro); }
        .txt-epico { color: var(--epico); }

    </style>
</head>
<body>

    <header class="header-principal">
        <h1 class="titulo-hextech">Sistema Hextech</h1>
        <div class="caixa-saldo">
            <span>üü°</span>
            <span id="valor-saldo">0</span>
        </div>
    </header>

    <nav class="abas-navegacao">
        <button class="btn-aba ativa" id="aba-loja" onclick="mudarSecao('loja')">Loja</button>
        <button class="btn-aba" id="aba-inventario" onclick="mudarSecao('inventario')">Meu Invent√°rio</button>
    </nav>

    <div class="barra-ferramentas" id="barra-ferramentas">
        <input type="text" id="busca" class="campo-busca" placeholder="Pesquisar item..." onkeyup="processarFiltros()">
        <div id="filtro-raridades">
            </div>
    </div>

    <main class="grid-principal" id="grid-principal">
        </main>

    <div class="modal-overlay" id="modal-global">
        <div class="modal-box">
            <div id="modal-nome" class="modal-titulo"></div>
            <div id="modal-descricao" class="modal-info"></div>
            <div class="botoes">
                <button id="btn-modal-acao" class="btn-confirmar">Confirmar</button>
                <button class="btn-cancelar" onclick="fecharModal()">Voltar</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, onSnapshot, updateDoc, arrayUnion, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyC4dm0KoyJswhyCY7tgbF4D2nmuZl84X8E",
            authDomain: "quizlegends-f58fc.firebaseapp.com",
            projectId: "quizlegends-f58fc",
            storageBucket: "quizlegends-f58fc.firebasestorage.app",
            messagingSenderId: "1050463164018",
            appId: "1:1050463164018:web:91de002b8afc8e678f54eb"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        // --- BANCO DE DADOS DE ITENS ---
        const CATALOGO = [
            { id: "aatrox_comum", cat: "icones", nome: "Aatrox", preco: 5000, raridade: "comum", img: "aatrox-comum.png", info: "√çcone oficial do campe√£o Aatrox." },
            { id: "aatrox_raro", cat: "icones", nome: "Aatrox Ca√ßador <br> de Almas", preco: 25000, raridade: "raro", img: "aatrox-raro.png", info: "√çcone raro da skin Ca√ßador de Almas." },
            { id: "ahri_epico", cat: "icones", nome: "Ahri K/DA", preco: 50000, raridade: "epico", img: "ahri-epico.png", info: "√çcone exclusivo da Ahri K/DA." },
            { id: "anjo_guardiao", cat: "itens", nome: "Anjo Guardi√£o <br> (7 Dias)", preco: 15000, raridade: "raro", img: "anjo.png", info: "Efeito: Prote√ß√£o contra perda de PDL por 7 dias." }
        ];

        const URL_ICONES = "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/√≠cones/";
        const URL_ITENS = "https://raw.githubusercontent.com/QuizLegends/quizlegends.github.io/main/itens/";

        let usuarioAtual = null;
        let secaoAtiva = 'loja';
        let dadosUser = { saldo: 0, iconesAdquiridos: [], fotoPerfil: "" };

        // --- MONITORAMENTO FIREBASE ---
        onAuthStateChanged(auth, (user) => {
            if (user) {
                usuarioAtual = user;
                onSnapshot(doc(db, "usuarios", user.uid), (snap) => {
                    if (snap.exists()) {
                        dadosUser = snap.data();
                        document.getElementById('valor-saldo').innerText = dadosUser.saldo.toLocaleString();
                        processarFiltros(); 
                    }
                });
            } else {
                window.location.href = "index.html";
            }
        });

        // --- L√ìGICA DE INTERFACE ---
        window.mudarSecao = (secao) => {
            secaoAtiva = secao;
            document.getElementById('aba-loja').classList.toggle('ativa', secao === 'loja');
            document.getElementById('aba-inventario').classList.toggle('ativa', secao === 'inventario');
            processarFiltros();
        };

        window.processarFiltros = () => {
            const grid = document.getElementById('grid-principal');
            const termoBusca = document.getElementById('busca').value.toLowerCase();
            grid.innerHTML = "";

            let lista = (secaoAtiva === 'loja') ? CATALOGO : CATALOGO.filter(i => dadosUser.iconesAdquiridos.includes(i.id));

            lista.forEach(item => {
                const nomeLimpo = item.nome.replace('<br>', '').toLowerCase();
                if (!nomeLimpo.includes(termoBusca)) return;

                const jaTem = dadosUser.iconesAdquiridos.includes(item.id);
                const emUso = dadosUser.fotoPerfil === item.img;
                const path = (item.cat === 'itens') ? URL_ITENS : URL_ICONES;

                const card = document.createElement('div');
                card.className = `card-item ${item.raridade}`;
                card.innerHTML = `
                    <img src="${path + item.img}" class="preview-imagem">
                    <div class="nome-item">${item.nome}</div>
                    <span class="label-raridade txt-${item.raridade}">${item.raridade}</span>
                    <button class="btn-acao" ${ (jaTem && secaoAtiva === 'loja') || emUso ? 'disabled' : ''} 
                        onclick="abrirModal('${item.id}')">
                        ${ obterTextoBotao(item, jaTem, emUso) }
                    </button>
                `;
                grid.appendChild(card);
            });
        };

        function obterTextoBotao(item, jaTem, emUso) {
            if (secaoAtiva === 'inventario') return emUso ? "Em Uso" : "Equipar";
            return jaTem ? "Adquirido" : `üí∞ ${item.preco}`;
        }

        // --- MODAL E COMPRA ---
        window.abrirModal = (id) => {
            const item = CATALOGO.find(i => i.id === id);
            const modal = document.getElementById('modal-global');
            document.getElementById('modal-nome').innerHTML = item.nome;
            document.getElementById('modal-descricao').innerText = item.info;
            
            const btn = document.getElementById('btn-modal-acao');
            modal.style.display = 'flex';

            if (secaoAtiva === 'loja') {
                btn.innerText = "Confirmar Compra";
                btn.onclick = () => realizarCompra(item);
            } else {
                btn.innerText = "Equipar Agora";
                btn.onclick = () => equiparItem(item.img);
            }
        };

        window.fecharModal = () => document.getElementById('modal-global').style.display = 'none';

        async function realizarCompra(item) {
            if (dadosUser.saldo < item.preco) return alert("Saldo insuficiente!");
            fecharModal();
            const ref = doc(db, "usuarios", usuarioAtual.uid);
            await updateDoc(ref, {
                saldo: increment(-item.preco),
                iconesAdquiridos: arrayUnion(item.id)
            });
        }

        async function equiparItem(nomeImg) {
            fecharModal();
            const ref = doc(db, "usuarios", usuarioAtual.uid);
            await updateDoc(ref, { fotoPerfil: nomeImg });
        }
    </script>
</body>
</html>
